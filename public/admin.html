<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaxMovies AI - Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-film"></i> MaxMovies AI Admin</h1>
                <p class="subtitle">Monitor and manage your AI assistant</p>
            </div>
            <div class="header-right">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
                <button class="btn btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="login-card">
                <h2><i class="fas fa-lock"></i> Admin Access</h2>
                <p>Enter your admin token to access the dashboard</p>
                
                <div class="form-group">
                    <label for="adminToken">Admin Token</label>
                    <div class="input-with-icon">
                        <i class="fas fa-key"></i>
                        <input type="password" id="adminToken" placeholder="Enter your admin token" />
                        <button class="btn-icon" onclick="toggleTokenVisibility()">
                            <i class="fas fa-eye" id="eyeIcon"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="apiUrl">API Base URL</label>
                    <div class="input-with-icon">
                        <i class="fas fa-link"></i>
                        <input type="text" id="apiUrl" 
                               value="https://your-api.vercel.app" 
                               placeholder="https://your-api.vercel.app" />
                    </div>
                </div>
                
                <button class="btn btn-primary btn-block" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="login-help">
                    <p><i class="fas fa-info-circle"></i> Get your token from environment variables</p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="dashboard" style="display: none;">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-tachometer-alt"></i> Navigation</h3>
                </div>
                <ul class="sidebar-menu">
                    <li class="active" onclick="showSection('overview')">
                        <i class="fas fa-home"></i> Overview
                    </li>
                    <li onclick="showSection('users')">
                        <i class="fas fa-users"></i> Users
                    </li>
                    <li onclick="showSection('memory')">
                        <i class="fas fa-database"></i> Memory
                    </li>
                    <li onclick="showSection('rateLimits')">
                        <i class="fas fa-tachometer-alt"></i> Rate Limits
                    </li>
                    <li onclick="showSection('system')">
                        <i class="fas fa-server"></i> System
                    </li>
                    <li onclick="showSection('tools')">
                        <i class="fas fa-tools"></i> Tools
                    </li>
                </ul>
                
                <div class="sidebar-footer">
                    <div class="quick-stats">
                        <div class="stat-item">
                            <span class="stat-label">Users</span>
                            <span class="stat-value" id="quickUserCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Online</span>
                            <span class="stat-value" id="quickOnline">0</span>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Overview Section -->
                <section id="overviewSection" class="dashboard-section">
                    <h2><i class="fas fa-chart-line"></i> System Overview</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Users</h3>
                                <div class="stat-number" id="totalUsers">0</div>
                                <div class="stat-trend">+0 today</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Conversations</h3>
                                <div class="stat-number" id="totalConversations">0</div>
                                <div class="stat-trend">+0 this hour</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Memory Usage</h3>
                                <div class="stat-number" id="memoryUsage">0 MB</div>
                                <div class="stat-trend" id="memoryTrend">Stable</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Rate Limits</h3>
                                <div class="stat-number" id="rateLimitFiles">0</div>
                                <div class="stat-trend">Active today</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Activity</h3>
                            <button class="btn btn-sm" onclick="refreshActivity()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>User ID</th>
                                            <th>Last Activity</th>
                                            <th>Last Project</th>
                                            <th>Messages</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activityTable">
                                        <tr>
                                            <td colspan="5" class="text-center">Loading...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="usersSection" class="dashboard-section" style="display: none;">
                    <h2><i class="fas fa-users"></i> User Management</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>All Users</h3>
                            <div class="header-actions">
                                <input type="text" id="userSearch" 
                                       placeholder="Search users..." 
                                       class="search-input"
                                       onkeyup="searchUsers()">
                                <button class="btn btn-primary" onclick="loadUsers()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>User ID</th>
                                            <th>Last Active</th>
                                            <th>Conversations</th>
                                            <th>Last Project</th>
                                            <th>Memory Size</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTable">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination">
                                <button class="btn" onclick="prevPage()" id="prevBtn" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <span id="pageInfo">Page 1 of 1</span>
                                <button class="btn" onclick="nextPage()" id="nextBtn" disabled>
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Memory Section -->
                <section id="memorySection" class="dashboard-section" style="display: none;">
                    <h2><i class="fas fa-database"></i> Memory Management</h2>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Warning:</strong> Modifying memory files can affect user experience.
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Memory Usage</h3>
                            <div class="header-actions">
                                <button class="btn btn-danger" onclick="clearAllMemory()">
                                    <i class="fas fa-trash"></i> Clear All Memory
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="memory-stats">
                                <div class="memory-stat">
                                    <span class="stat-label">Total Memory Files:</span>
                                    <span class="stat-value" id="memoryFileCount">0</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="stat-label">Total Size:</span>
                                    <span class="stat-value" id="memoryTotalSize">0 MB</span>
                                </div>
                                <div class="memory-stat">
                                    <span class="stat-label">Average per User:</span>
                                    <span class="stat-value" id="memoryAvgSize">0 KB</span>
                                </div>
                            </div>
                            
                            <div class="progress-container">
                                <label>Memory Distribution</label>
                                <div class="progress">
                                    <div class="progress-bar" id="memoryBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-labels">
                                    <span>0%</span>
                                    <span id="memoryPercent">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- System Section -->
                <section id="systemSection" class="dashboard-section" style="display: none;">
                    <h2><i class="fas fa-server"></i> System Information</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>System Stats</h3>
                            <button class="btn btn-sm" onclick="loadSystemStats()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="system-info-grid">
                                <div class="info-item">
                                    <span class="info-label">Uptime:</span>
                                    <span class="info-value" id="systemUptime">0s</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Node Version:</span>
                                    <span class="info-value" id="nodeVersion">v0.0.0</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Heap Used:</span>
                                    <span class="info-value" id="heapUsed">0 MB</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Heap Total:</span>
                                    <span class="info-value" id="heapTotal">0 MB</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">RSS Memory:</span>
                                    <span class="info-value" id="rssMemory">0 MB</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Last Updated:</span>
                                    <span class="info-value" id="lastUpdated">Never</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>API Endpoints</h3>
                        </div>
                        <div class="card-body">
                            <div class="endpoints-list">
                                <div class="endpoint">
                                    <span class="endpoint-method get">GET</span>
                                    <span class="endpoint-path">/api/maxmovies</span>
                                    <span class="endpoint-desc">Main AI endpoint</span>
                                </div>
                                <div class="endpoint">
                                    <span class="endpoint-method get">GET</span>
                                    <span class="endpoint-path">/api/admin?action=stats</span>
                                    <span class="endpoint-desc">System statistics</span>
                                </div>
                                <div class="endpoint">
                                    <span class="endpoint-method get">GET</span>
                                    <span class="endpoint-path">/api/admin?action=users</span>
                                    <span class="endpoint-desc">List all users</span>
                                </div>
                                <div class="endpoint">
                                    <span class="endpoint-method delete">DELETE</span>
                                    <span class="endpoint-path">/api/admin?action=delete&userId=ID</span>
                                    <span class="endpoint-desc">Delete user memory</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tools Section -->
                <section id="toolsSection" class="dashboard-section" style="display: none;">
                    <h2><i class="fas fa-tools"></i> Admin Tools</h2>
                    
                    <div class="tools-grid">
                        <div class="tool-card">
                            <div class="tool-icon">
                                <i class="fas fa-trash-alt"></i>
                            </div>
                            <h3>Clear User Memory</h3>
                            <p>Remove all memory for a specific user</p>
                            <div class="tool-form">
                                <input type="text" id="clearUserId" 
                                       placeholder="Enter User ID" 
                                       class="form-control">
                                <button class="btn btn-danger" onclick="clearUserMemory()">
                                    Clear Memory
                                </button>
                            </div>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">
                                <i class="fas fa-ban"></i>
                            </div>
                            <h3>Reset Rate Limits</h3>
                            <p>Reset rate limits for a user</p>
                            <div class="tool-form">
                                <input type="text" id="resetUserId" 
                                       placeholder="Enter User ID" 
                                       class="form-control">
                                <button class="btn btn-warning" onclick="resetUserRateLimit()">
                                    Reset Limits
                                </button>
                            </div>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h3>User Lookup</h3>
                            <p>Find detailed information about a user</p>
                            <div class="tool-form">
                                <input type="text" id="lookupUserId" 
                                       placeholder="Enter User ID" 
                                       class="form-control">
                                <button class="btn btn-info" onclick="lookupUser()">
                                    Lookup User
                                </button>
                            </div>
                        </div>
                        
                        <div class="tool-card">
                            <div class="tool-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <h3>Export Data</h3>
                            <p>Export user data as JSON</p>
                            <div class="tool-form">
                                <input type="text" id="exportUserId" 
                                       placeholder="User ID (leave empty for all)" 
                                       class="form-control">
                                <button class="btn btn-success" onclick="exportData()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Modals -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">User Details</h3>
                    <button class="btn-icon" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    Loading...
                </div>
                <div class="modal-footer">
                    <button class="btn" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>
